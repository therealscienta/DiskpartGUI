<Window x:Class="DiskpartGUI.Views.Dialogs.MovePartitionDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:DiskpartGUI.Converters"
        Title="Move Partition"
        Width="500" Height="420"
        Background="#16213E"
        Foreground="#ECF0F1"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        ShowInTaskbar="False">

    <Window.Resources>
        <ResourceDictionary Source="../../Resources/Styles.xaml"/>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0" Text="Move Partition" FontSize="16" FontWeight="SemiBold"
                   Foreground="#2F80ED" Margin="0,0,0,16"/>

        <!-- Body — two phases in the same row, toggled by Visibility -->
        <Grid Grid.Row="1">

            <!-- ── Configure phase ── -->
            <StackPanel Visibility="{Binding ShowConfigure,
                Converter={StaticResource BoolToVis}, ConverterParameter=notNull,
                FallbackValue=Visible}">

                <TextBlock Text="{Binding PartitionDescription}" Foreground="#ECF0F1"
                           FontSize="13" Margin="0,0,0,12" TextWrapping="Wrap"/>

                <TextBlock Text="SELECT DESTINATION" Foreground="#95A5A6"
                           FontSize="11" FontWeight="SemiBold" Margin="0,0,0,6"/>

                <ListBox ItemsSource="{Binding AvailableRegions}"
                         SelectedItem="{Binding SelectedRegion, Mode=TwoWay}"
                         Background="#1A1A2E" BorderBrush="#34495E" BorderThickness="1"
                         Foreground="#ECF0F1" Height="120"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="4,4">
                                <TextBlock Text="{Binding DisplaySize}" FontWeight="SemiBold"
                                           Foreground="#ECF0F1" Margin="0,0,12,0"/>
                                <TextBlock Text="free at offset" Foreground="#95A5A6" Margin="0,0,6,0"/>
                                <TextBlock Text="{Binding DisplayOffset}" Foreground="#95A5A6"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Warning -->
                <Border Background="#1C2533" BorderBrush="#E67E22" BorderThickness="1"
                        CornerRadius="4" Padding="12,10" Margin="0,12,0,0">
                    <TextBlock Foreground="#E67E22" FontSize="12" TextWrapping="Wrap">
                        <Run FontWeight="SemiBold">⚠  Warning: </Run>
                        <Run>All partition data will be physically copied sector-by-sector. This may take
several minutes for large partitions. Do not power off your computer during the
operation. The original partition remains intact if you cancel before completion.</Run>
                    </TextBlock>
                </Border>
            </StackPanel>

            <!-- ── Progress phase ── -->
            <StackPanel Visibility="{Binding ShowProgress,
                Converter={StaticResource BoolToVis}, ConverterParameter=notNull,
                FallbackValue=Collapsed}">

                <TextBlock Text="{Binding PartitionDescription}" Foreground="#ECF0F1"
                           FontSize="13" Margin="0,0,0,20" TextWrapping="Wrap"/>

                <ProgressBar Value="{Binding ProgressPercent}" Minimum="0" Maximum="100"
                             Height="20" Margin="0,0,0,8"
                             Background="#1A1A2E" Foreground="#2F80ED"/>

                <TextBlock Text="{Binding ProgressStatus}" Foreground="#95A5A6"
                           FontSize="12" Margin="0,0,0,16"/>

                <!-- Status message (complete / cancelled / in-progress) -->
                <Border Background="#1A2533" BorderBrush="#2F80ED" BorderThickness="1"
                        CornerRadius="4" Padding="12,10"
                        Visibility="{Binding IsComplete,
                            Converter={StaticResource BoolToVis}, ConverterParameter=notNull,
                            FallbackValue=Collapsed}">
                    <TextBlock Text="{Binding StatusMessage}" Foreground="#2ECC71"
                               FontSize="12" TextWrapping="Wrap" FontWeight="SemiBold"/>
                </Border>

                <Border Background="#2C1F1F" BorderBrush="#E74C3C" BorderThickness="1"
                        CornerRadius="4" Padding="12,10"
                        Visibility="{Binding IsCancelled,
                            Converter={StaticResource BoolToVis}, ConverterParameter=notNull,
                            FallbackValue=Collapsed}">
                    <TextBlock Text="{Binding StatusMessage}" Foreground="#E74C3C"
                               FontSize="12" TextWrapping="Wrap"/>
                </Border>
            </StackPanel>
        </Grid>

        <!-- Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">

            <!-- Cancel (configure phase) -->
            <Button Content="Cancel" Style="{StaticResource PrimaryButtonStyle}"
                    Background="#34495E" Margin="0,0,8,0"
                    Command="{Binding CloseCommand}"
                    Visibility="{Binding ShowConfigure,
                        Converter={StaticResource BoolToVis}, ConverterParameter=notNull,
                        FallbackValue=Visible}"/>

            <!-- Move (configure phase) -->
            <Button Content="Move" Style="{StaticResource PrimaryButtonStyle}"
                    Command="{Binding MoveCommand}"
                    Visibility="{Binding ShowConfigure,
                        Converter={StaticResource BoolToVis}, ConverterParameter=notNull,
                        FallbackValue=Visible}"/>

            <!-- Cancel (progress phase) -->
            <Button Content="Cancel" Style="{StaticResource DangerButtonStyle}"
                    Margin="0,0,8,0"
                    Command="{Binding CancelCommand}"
                    IsEnabled="{Binding CanCancel}"
                    Visibility="{Binding ShowProgress,
                        Converter={StaticResource BoolToVis}, ConverterParameter=notNull,
                        FallbackValue=Collapsed}"/>

            <!-- Close (after done/cancelled) -->
            <Button Content="Close" Style="{StaticResource PrimaryButtonStyle}"
                    Background="#34495E"
                    Command="{Binding CloseCommand}"
                    Visibility="{Binding ShowClose,
                        Converter={StaticResource BoolToVis}, ConverterParameter=notNull,
                        FallbackValue=Collapsed}"/>
        </StackPanel>
    </Grid>
</Window>
